# 数据清洗

这里对`我爱我家-租房数据-更新至2024.03.24`进行处理：

数据描述：我们获得数据集维度共54维，共有数据在以下：

1. **房源编号**：房源的唯一标识符，用于区分每个房源。
2. **出租方式**：房源的出租类型，例如整租、合租等。
3. **街道**：房源所在的街道名称。
4. **小区**：房源所在的小区名称。
5. **租金**：房源的月租金。
6. **卧室数量**：房源中卧室的数量。
7. **客厅数量**：房源中客厅的数量。
8. **面积**：房源的总面积（通常以平方米为单位）。
9. **朝向**：房源的主要朝向，如朝南、朝北等。
10. **楼层**：房源所在的楼层。
11. **最高楼层**：建筑的总楼层数。
12. **装修情况**：房源的装修级别，如精装修、简装等。
13. **关注人数**：对房源感兴趣的人数。
14. **近30天带看**：近30天内房源的带看次数。
15. **发布时间**：房源信息发布的日期。
16. **所在经度**：房源地理位置的经度。
17. **所在纬度**：房源地理位置的纬度。
18. **最近的地铁站经度**和**纬度**：最近地铁站的地理位置。
19. **最近的公交站经度**和**纬度**：最近公交站的地理位置。
20. **地铁直线距离**：房源到最近地铁站的直线距离。
21. **公交直线距离**：房源到最近公交站的直线距离。
22. **地铁步行距离**和**公交步行距离**：步行至最近的地铁站和公交站的距离。
23. **地铁步行时长**和**公交步行时长**：步行至最近的地铁站和公交站所需的时间。
24. **1km内餐厅/大学或大专/办公室/医院/健身房**：1公里范围内相应设施的数量。
25. **房源亮点**：房源的主要特色和优势。
26. **户型介绍**：详细描述房源的户型布局。
27. **交通出行**：描述房源周边的交通情况。
28. **周边配套**：描述房源周边的配套设施如购物中心、公园等。
29. **小区信息**：提供房源所在小区的详细信息。
30. **家电设备（洗衣机、冰箱、电视、空调、热水器、天然气、暖气、床、网络、衣柜）**：标示这些家具是否配备在房源内。
31. **交通、生活、品质、医疗、运动**：关于房源的这些方面的额外信息。
32. **最低参考价**和**最高参考价**：提供关于房源租金的参考价格区间。


1. 对爬虫期间已被租售数据进行剔除（详情页显示没有了）：

   原始数据：28938行

   剔除数据：2643行

   现有数据：26295行


2. 我们需要处理缺失值
   - 检查每列的非空值数目，对于缺失值较多的列（例如：洗衣机、冰箱、电视等），考虑填充、删除或使用模型预测缺失值。这里我们采用的方法是计算每个家电特征的True值的百分比，若该百分比不少于75%，则将该特征列中的缺失值填充为True，否则填充为False。

3. **过滤异常数据**：
   - **租金异常**：过滤出租金过高或过低的数据，我们设定租金不得低于第5百分位数且不得高于第95百分位数，
   - **面积异常**：同样地，面积过大或过小的记录可能是异常或错误数据，面积不得低于第5百分位数且不得高于第95百分位数，

4. **确保租金在参考价范围内**：

   - 过滤掉不在最低参考价与最高参考价之间的数据。即保留所有满足 `最低参考价 <= 租金 <= 最高参考价` 的记录。

   在2，3，4处理后，

   原始数据：26295行

   剔除数据：7360行

   现有数据：18935行

5. 由于房源亮点、户型介绍、交通出行、周边配套、小区信息以及小区的五维特征信息交通、生活、品质、医疗、运动，都是以文字段落呈现给租客的，机器无法识别，并且无法读取，我们需要用工具对他来进行NLP分析，以小区信息为例，由于大部分数据都包含绿化率、建筑年代、物业信息、停车位信息，我们利用。。工具提取这些方面的信息，由于代码过于冗长，且执行效率较低，我们最后采取调用openai API的方式，从而快速提取关键信息。

在数据清理过程中，我们针对已被出租的房源，也就是在房源详情页面没有显示具体数据的房源数据进行了清除。我们初始数据集包含了28,938条记录，经过剔除已出租的房源后，剩余有效房源数据为26,295条。

接着，在处理缺失值方面，我们对数据集中每一列的非空值进行了检查，对于大多数列，我们对缺失值采用的是空白值（没有爬取到的和爬取详情页没有该数据的（由于某些特征是后面才加上去的，前期没有维护这些数据））填补中位数，对于某些没有提取到的数据，直接用0来填补缺失值。由于家电特征列是布尔值，并且大多数房源配置都相对一样，我们针对家电类特征（如洗衣机、冰箱、电视等）采取了特定策略，我们计算了家电True值的百分比，若某一家电的True值百分比不低于75%，且房间不是毛坯房，则将该特征的缺失值填充为True，否则填充为False，如果是精装、豪装就直接填补True，如果是毛坯房，直接填补False。

在处理缺失值时，我们首先对数据集中每一列的非空值进行了详细检查。对于大部分数据列，我们发现缺失的数据主要是由于在爬取过程中未能获取到数据或详情页本身就缺少这些数据，这往往是因为某些特征在数据集的早期阶段未被维护。针对这类情况，我们采取了填补中位数的方法处理缺失值（空值）。对于那些未提取到的数据（None），我们选择用0来填补。

对于家电特征列，这些通常是布尔值，并且大多数房源在家电配置上相对一致。我们根据家电特征的布尔值进行了特定的处理策略：计算了每种家电True值的百分比。如果某家电的True值百分比不低于75%，并且该房源不属于毛坯房，我们便将缺失值填充为True。对于精装或豪装的房源，由于装修级别较高，我们直接将这些家电特征的缺失值填充为True；而对于毛坯房，考虑到这类房源通常不包括完整的家电配置，我们则将其缺失值填充为False。

由于房源亮点、户型介绍、交通出行、周边配套、小区信息以及小区的五维特征信息（如交通、生活、品质、医疗、运动）均以文本段落形式呈现，机器难以直接识别和处理。因此，我们采用自然语言处理NLP工具来分析这些文本数据，例如从小区信息中提取关键信息如绿化率、建筑年代、物业信息和停车位信息等。考虑到原有代码的复杂度和执行效率问题，我们选择调用OpenAI API来实现快速有效的关键信息提取。

最后，我们需要过滤异常数据，我们最后在排查数据后，移除了租金过高或过低的记录，标准为租金不得低于第5百分位数且不得高于第95百分位数。同理，面积过大或过小的记录也被筛选掉，以排除潜在的异常或错误占位符数据（如上架时，直接填写了9999等）。确保租金在参考价范围内是另一重要步骤，我们保留了所有满足最低参考价与最高参考价之间的数据记录。经过上述处理，最终剩余的数据量为18,935条，从原始的26,295条中剔除了7,360条数据。
